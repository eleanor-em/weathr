<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script>
            function generateCityData(city) {
                document.getElementById("city-name").innerText = city.city_name;
                document.getElementById("country-name").innerText = city.country_name;
                let url = "https://lipis.github.io/flag-icon-css/flags/4x3/" + city.country_code.toLowerCase() + ".svg";
                console.log(url);
                document.getElementById("flag").src = url;
                document.getElementById("desc").innerText = city.desc;
                document.getElementById("temp-max").innerText = city.temp.max;
                document.getElementById("temp-min").innerText = city.temp.min;
                document.getElementById("rainfall").innerText = city.rainfall;
                document.getElementById("humidity").innerText = city.humidity;

                let icon = "images/";
                switch (city.type) {
                    case "Rain":
                        icon += "rain.ico";
                        break;
                    case "Clear":
                        icon += "sunny.png";
                        break;
                    case "Cloudy":
                        if (city.desc == "few clouds") {
                            icon += "cloudy.png";
                            break;
                        }
                    default:
                        icon += "scattered-clouds.ico";
                }
                document.getElementsByClassName("display-image")[0].src = icon;
            }
        </script>
    </head>
    <body>
        <div class="city-container">
            <div class="name">
                <h3 id="city-name">Villers-sur-Mer</h3>
                <h4 id="country-name">France</h4>
            </div>
            <div class="flag-container"><img id="flag" src="https://lipis.github.io/flag-icon-css/flags/4x3/fr.svg"></div>
            <table class="data-container">
                <tr>
                    <td class="data">
                        <img class="display-image" src="images/rain.ico"><br>
                        <span id="desc">lightly raining</span>
                    </td>
                    <td class="data">
                        <h3 id="temp-max">19&deg;</h3>
                    </td>
                </tr>
                <tr>
                    <td class="data">
                        <table class="rain-container">
                            <tr>
                                <td class="subcontainer"><img class="data-image" src="images/rain_amount.png"></td>
                                <td class="subcontainer"><span id="rainfall">1.3</span> mL</td>
                            </tr>
                            <tr>
                                <td class="subcontainer"><img class="data-image" src="images/humidity_amount.png"</td>
                                <td class="subcontainer" id="humidity">88%</td>
                            </tr>
                        </table>
                    </td>
                    <td class="data">
                        <h4 id="temp-min">14&deg;</h4>
                    </td>
                </tr>
            </table>
        </div>
        <div class="button-container">
            <a href="#"><img class="button" src="images/no.png" onclick="newData()"></a>
            <a href="#"><img class="button" src="images/yes.png" onclick="newData()"></a>
        </div>
        <script src="sample.json"></script>
        <script>
            function newData() {
                fetch('./api/random')
                .then(res => {
                    if (res.status >= 200 && res.status < 300){
                        return Promise.resolve(res);
                    }
                    return Promise.reject(new Error(res.statusText));
                }).then(res => res.json()).then(data => {
                    console.log(data);
                    generateCityData(data);
                }).catch(err => {
                    alert(err);
                });
            }
        </script>
    </body>
</html>